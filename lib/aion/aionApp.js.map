{"version":3,"sources":["../../src/aion/aionApp.js"],"names":["HARDENED_KEY_MULTIPLIER","BIP44_MAX_OFFSET","AION_BASIC_PATH","Buffer","from","AION_APP_PREFIX","P1","P2","INS_GET_PUBLIC_KEY","INS_SIGN","getHardenedNumber","nr","toString","generateBip44Path","derivationIndex","offsetExpanded","Error","concat","genGetPublicKeyAPDUCommand","path","length","genSignPayloadAPDUCommand","payload","AionApp","transport","scrambleKey","decorateAppAPIMethods","buffer","send","response","pubKey","slice","address","console","log"],"mappings":"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","sourcesContent":["//@flow\nconst HARDENED_KEY_MULTIPLIER = 0x80000000;\nconst BIP44_MAX_OFFSET = 0x0FFFFFFF;\nconst AION_BASIC_PATH  =  Buffer.from('8000002C800001A98000000080000000', 'hex');\nconst AION_APP_PREFIX = 0xe0;\n\nconst P1 = 0x00;\nconst P2 = 0x00;\n\nconst INS_GET_PUBLIC_KEY = 0x02;\nconst INS_SIGN = 0x04;\n\nfunction getHardenedNumber(nr){\n    return Buffer.from(((HARDENED_KEY_MULTIPLIER | nr) >>> 0).toString(16), 'hex');\n}\n\nfunction generateBip44Path(derivationIndex: number) {\n    let offsetExpanded = derivationIndex & 0x00000000FFFFFFFF;\n    if(offsetExpanded>BIP44_MAX_OFFSET){\n        throw Error(`derivationIndex cannot be greater than BIP44_MAX_OFFSET ${BIP44_MAX_OFFSET}`);\n    }\n    return Buffer.concat([AION_BASIC_PATH, getHardenedNumber(derivationIndex)]);\n    // return Buffer.from('8000002c8000003c800000000000000000000000','hex');\n}\n\n\nfunction  genGetPublicKeyAPDUCommand(path: Buffer) {\n    return Buffer.concat([Buffer.from([path.length/4]), path]);\n}\n\nfunction  genSignPayloadAPDUCommand(path: Buffer, payload: Buffer) {\n    return Buffer.concat([Buffer.from([path.length/4]), path, payload]);\n}\n\n\n\nexport default class AionApp{\n\n    constructor(transport, scrambleKey = 'aion'){\n        if (typeof  transport === 'undefined'){\n            throw new Error('Transport has not been defined');\n        }\n        this.transport = transport;\n        transport.decorateAppAPIMethods(\n            this,\n            [\n                'getAccount',\n                'sign',\n            ],\n            scrambleKey\n        );\n    }\n\n\n\n    async getAccount(derivationIndex: number){\n        try {\n            let path = generateBip44Path(derivationIndex);\n            let buffer = genGetPublicKeyAPDUCommand(path);\n            const response = await this.transport.send(AION_APP_PREFIX, INS_GET_PUBLIC_KEY, P1, P2, buffer);\n            const pubKey = Buffer.from(response.slice(0, 32)).toString('hex');\n            const address = '0x'+ Buffer.from(response.slice(32,64)).toString('hex');\n            return {pubKey, address}\n        }catch (e) {\n            console.log(`get Account error => ${e}`);\n            throw e;\n        }\n    }\n\n    async sign(derivationIndex: number, payload: Buffer) {\n        try {\n            let path = generateBip44Path(derivationIndex);\n            let buffer = genSignPayloadAPDUCommand(path, payload);\n            const response = await this.transport.send(AION_APP_PREFIX, INS_SIGN, P1, P2, buffer);\n            return Buffer.from(response.slice(0, 64)).toString('hex')\n        }catch (e) {\n            console.log(`get Account error => ${e}`);\n            throw e;\n        }\n    }\n\n}\n"],"file":"aionApp.js"}